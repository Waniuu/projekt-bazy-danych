<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Studenta</title>
    <link rel="stylesheet" href="templatemo-noir-fashion.css">
</head>

<body>
<nav id="navbar">
    <div class="nav-container">
        <a href="index.html" class="logo-link">
            <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ff3366;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <polygon points="50,10 20,50 50,90 80,50" fill="none" stroke="url(#logoGrad)" stroke-width="3"/>
                <circle cx="50" cy="50" r="5" fill="url(#logoGrad)"/>
            </svg>
            <span class="logo-text">Panel Studenta</span>
        </a>
        <ul class="nav-links">
            <li><a class="nav-link active">Dashboard</a></li>
            <li><a class="nav-cta" onclick="logout()">Wyloguj</a></li>

        </ul>
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
</nav>


<section class="hero" id="home">
    <div class="hero-bg"></div>
    <div class="hero-container">
        <div class="hero-left">
            <h1 class="hero-title">
                <span class="line"><span><span class="accent">Twoje</span></span></span>
                <span class="line"><span>testy</span></span>
            </h1>
            <p class="hero-description">
                Masz wszystko pod swoją ręką
            </p>
        </div>
        <div class="hero-right">

            <div class="student-info-card"
                 style="background:rgba(255,255,255,0.08);
                padding:20px;
                border-radius:15px;
                backdrop-filter:blur(5px);
                margin-bottom:20px;
                color:white;">

                <h3 style="margin-bottom:10px;">Twoje dane</h3>

                <p><b>Imię:</b> <span id="studentImie"></span></p>
                <p><b>Nazwisko:</b> <span id="studentNazwisko"></span></p>
                <p><b>Email:</b> <span id="studentEmail"></span></p>
                <p><b>Numer indeksu:</b> <span id="studentIndeks"></span></p>
                <p><b>Średnia ocen:</b>
                    <span id="studentSrednia" style="color:#ff3366;font-weight:bold;"></span>
                </p>
            </div>

            <p class="section-subtitle"></p>
            <section class="collections" id="wyniki">
                <div class="section-header">
                    <h2 class="section-title"></h2>
                </div>
            </section>
        </div>
    </div>
    </div>
</section>

<section class="collections" id="collections">
    <div class="section-header">
        <h2 class="section-title">Ostatnie wyniki</h2>
        <p class="section-subtitle">Historia wyników z testów</p>
    </div>


    <div class="grid" id="collectionsGrid">
        <div class="collection-card" data-category="women">
            <div class="collection-thumbnail">
                <img src="images/urban-edge.avif" alt="Urban Edge Women's Collection">
            </div>
            <div class="card-content">
                <span class="card-badge">New Arrival</span>
                <h3 class="card-title">Matematyka</h3>
                <p class="card-subtitle">Statystyka</p>
                <p class="card-price">From $299</p>
            </div>
        </div>
    </div>
</section>
<section class="featured" id="featured">
    <div class="featured-container">
        <div class="featured-hero">
            <div class="featured-content">
                <span class="label">Ucz się bez limitu</span>
                <h2>Ostatnie wyniki</h2>
                <p>Historia wyników z testów</p>

                <div class="testimonials">
                    <div class="testimonials-grid" id="wynikiContainer">
                        Ładowanie wyników...
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
function logout() {
    localStorage.removeItem("user");
    window.location.href = "logowanie.html";
}

async function loadStudentInfo(userId) {
    const data = await fetch(
        `https://projekt-bazy-danych-backend.onrender.com/api/uzytkownicy/${userId}`
    ).then(r => r.json());

    document.getElementById("studentImie").textContent = data.imie;
    document.getElementById("studentNazwisko").textContent = data.nazwisko;
    document.getElementById("studentEmail").textContent = data.email;
    document.getElementById("studentIndeks").textContent = data.numer_indeksu ?? "—";

    const wyniki = await fetch(
        `https://projekt-bazy-danych-backend.onrender.com/api/wyniki/${userId}`
    ).then(r => r.json());

    if (!wyniki.length) {
        document.getElementById("studentSrednia").textContent = "Brak danych";
        return;
    }

    const avg = (
        wyniki.reduce((sum, w) => sum + (w.ocena || 0), 0) / wyniki.length
    ).toFixed(2);

    document.getElementById("studentSrednia").textContent = avg;
}

async function loadResults(studentId) {
    const wyniki = await fetch(
        `https://projekt-bazy-danych-backend.onrender.com/api/wyniki/${studentId}`
    ).then(r => r.json());

    const wynikiDiv = document.getElementById("wynikiContainer");
    wynikiDiv.innerHTML = "";

    if (!wyniki.length) {
        wynikiDiv.innerHTML = "<p>Brak wyników.</p>";
        return;
    }

    wyniki.forEach(w => {
        wynikiDiv.innerHTML += `
        <div class="testimonial-card">
            <div class="testimonial-rating">⭐ ${w.ocena}/6</div>
            <div class="testimonial-quote">
                <b>${w.nazwa_testu || "Test"}</b><br>
                Punkty: <span style="color:#ff3366; font-weight:bold;">${w.liczba_punktow}</span><br>
                Data: ${w.data}
            </div>
        </div>`;
    });
}

async function loadStudentData() {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) return logout();

    const studentId = user.id;

    loadStudentInfo(studentId);  // ✔ POPRAWIONE
    loadResults(studentId);      // ✔ wyniki będą działać
}

loadStudentData();   // ✔ tylko jedno wywołanie

</script>



</body>
</html>







