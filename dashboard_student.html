<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Studenta</title>
    <link rel="stylesheet" href="templatemo-noir-fashion.css">
</head>

<body>
<nav id="navbar">
    <div class="nav-container">
        <a href="index.html" class="logo-link">
            <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ff3366;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <polygon points="50,10 20,50 50,90 80,50" fill="none" stroke="url(#logoGrad)" stroke-width="3"/>
                <circle cx="50" cy="50" r="5" fill="url(#logoGrad)"/>
            </svg>
            <span class="logo-text">Panel Studenta</span>
        </a>
        <ul class="nav-links">
            <li><a class="nav-link active">Dashboard</a></li>
            <li><a class="nav-cta" onclick="logout()">Wyloguj</a></li>

        </ul>
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
</nav>


<section class="hero" id="home">
    <div class="hero-bg"></div>
    <div class="hero-container">
        <div class="hero-left">
            <h1 class="hero-title">
                <span class="line"><span><span class="accent">Twoje</span></span></span>
                <span class="line"><span>testy</span></span>
            </h1>
        </div>
        <div class="hero-right">
            <p class="section-subtitle">Wybierz test z kategorii z bazy danych</p>
            <section class="collections" id="wyniki">
                <div class="section-header">
                    <h2 class="section-title">Ostatnie wyniki</h2>
                </div>
                <div class="grid" id="wynikiContainer">≈Åadowanie wynik√≥w...</div>
            </section>
        </div>
    </div>
    </div>
</section>

<section class="collections" id="collections">
    <div class="section-header">
        <h2 class="section-title">Ostatnie wyniki</h2>
        <p class="section-subtitle">Historia wynik√≥w z test√≥w</p>
    </div>


    <div class="grid" id="collectionsGrid">
        <div class="collection-card" data-category="women">
            <div class="collection-thumbnail">
                <img src="images/urban-edge.avif" alt="Urban Edge Women's Collection">
            </div>
            <div class="card-content">
                <span class="card-badge">New Arrival</span>
                <h3 class="card-title">Matematyka</h3>
                <p class="card-subtitle">Statystyka</p>
                <p class="card-price">From $299</p>
            </div>
        </div>
    </div>
</section>
<script>
    function logout() {
        localStorage.removeItem("user");
        window.location.href = "logowanie.html";
    }

    async function loadStudentData() {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) return logout();

        const studentId = user.id;

        // ≈ÅADOWANIE KATEGORII
        const categories = await fetch("https://projekt-bazy-danych-backend.onrender.com/api/kategorie")
            .then(r => r.json());

        const grid = document.getElementById("collectionsGrid");
        grid.innerHTML = "";

        // --- PIERWSZE 3 KATEGORIE ---
        const first3 = categories.slice(0, 3);
        const rest = categories.slice(3);

        first3.forEach(cat => {
            grid.innerHTML += `
            <div class="collection-card">
                <div class="collection-thumbnail">
                    <img src="images/neo-classic.avif">
                </div>
                <div class="card-content">
                    <h3 class="card-title">${cat.nazwa}</h3>
                    <p class="card-subtitle">${cat.opis || ""}</p>
                    <a href="start-test.html?id=${cat.id_kategorii}" class="cta-button primary">Rozpocznij</a>
                </div>
            </div>`;
        });

        // --- PRZYCISK "ZOBACZ WIƒòCEJ" ---
        grid.innerHTML += `
        <div id="showMoreCard" class="collection-card"
            style="display:flex;align-items:center;justify-content:center;text-align:center;">
            <button onclick="expandCategories()"
                style="
                    padding: 15px 25px;
                    font-size: 18px;
                    border-radius: 10px;
                    border: none;
                    background:#ff3366;
                    color:white;
                    cursor:pointer;
                ">
                Zobacz wiƒôcej ‚Üì
            </button>
        </div>
    `;

        // --- UKRYTY DIV NA DODATKOWE KATEGORIE ---
        const hidden = document.createElement("div");
        hidden.id = "extraCategories";
        hidden.style.display = "none";

        rest.forEach(cat => {
            hidden.innerHTML += `
            <div class="collection-card">
                <div class="collection-thumbnail">
                    <img src="images/neo-classic.avif">
                </div>
                <div class="card-content">
                    <h3 class="card-title">${cat.nazwa}</h3>
                    <p class="card-subtitle">${cat.opis || ""}</p>
                    <a href="start-test.html?id=${cat.id_kategorii}" class="cta-button primary">Rozpocznij</a>
                </div>
            </div>`;
        });

        grid.appendChild(hidden);

        // --- ≈ÅADOWANIE WYNIK√ìW ---
        loadResults(studentId);
    }

    // --- FUNKCJA ROZWIJAJƒÑCA LISTƒò ---
    function expandCategories() {
        document.getElementById("extraCategories").style.display = "grid";
        document.getElementById("showMoreCard").remove();
    }

    async function loadResults(studentId) {
        const wyniki = await fetch(`https://projekt-bazy-danych-backend.onrender.com/api/wyniki/${studentId}`)
            .then(r => r.json());

        const wynikiDiv = document.getElementById("wynikiContainer");
        wynikiDiv.innerHTML = "";

        if (!wyniki.length) {
            wynikiDiv.innerHTML = "<p>Brak wynik√≥w do wy≈õwietlenia.</p>";
            return;
        }

        wyniki.forEach(w => {
            wynikiDiv.innerHTML += `
            <div class="score-box">
                <b>${w.nazwa_testu || "Nieznany test"}</b><br>
                Punkty: <span style="color:#ff3366; font-weight:bold;">${w.liczba_punktow}</span><br>
                Ocena: <b>${w.ocena}</b><br>
                Data: ${w.data}
            </div>`;
        });
    }

    loadStudentData();
    // üî• FUNKCJA BY≈ÅA SCHOWANA ‚Äî TERAZ NA ZEWNƒÑTRZ I WYWO≈ÅYWANA
    async function loadResults(studentId) {

        const wyniki = await fetch(`https://projekt-bazy-danych-backend.onrender.com/api/wyniki/${studentId}`)
            .then(r => r.json());

        const wynikiDiv = document.getElementById("wynikiContainer");
        wynikiDiv.innerHTML = "";

        if (!wyniki.length) {
            wynikiDiv.innerHTML = "<p>Brak wynik√≥w do wy≈õwietlenia.</p>";
            return;
        }

        wyniki.forEach(w => {
            wynikiDiv.innerHTML += `
            <div class="score-box">
                <b>${w.nazwa_testu || "Nieznany test"}</b><br>
                Punkty: <span style="color:#ff3366; font-weight:bold;">${w.liczba_punktow}</span><br>
                Ocena: <b>${w.ocena}</b><br>
                Data: ${w.data}
            </div>
        `;
        });
    }
    loadStudentData();
</script>



</body>
</html>






